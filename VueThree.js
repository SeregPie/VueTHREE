!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):e.VueThree=t(e.THREE)}(this,function(e){"use strict";function t(e){return{created:function(){var t=this;e.forEach(function(e){t.$watch(e)})}}}var n={color:{type:[Number,String],default:0},near:{type:Number,default:1},far:{type:Number,default:1e3}};var o={fog:function(){return new e.Fog}};var r={name:"VueThreeFog",mixins:[t([function(){this.fog.color.set(this.color)},function(){this.fog.near=this.near},function(){this.fog.far=this.far}])],props:n,computed:o,created:function(){this.$parent.object.fog=this.fog},beforeDestroy:function(){this.$parent.object.fog=null},render:function(e){return e("div")}};function i(e){for(var t,n,o=[],r=arguments.length-1;r-- >0;)o[r]=arguments[r+1];return t=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var o=new Set;return e.forEach(function(e){t.every(function(t){return!t.has(e)})&&o.add(e)}),o}.apply(void 0,[new Set(e)].concat(o.map(function(e){return new Set(e)}))),n=[],t.forEach(function(e){n.push(e)}),n}function a(){}function s(e){return function(){return e}}var c=s(!1),u=s(null);var l=new e.Vector2,h=new e.Vector2;function d(t,n){var o=n.getBoundingClientRect(),r=new e.Vector2(o.left,o.top),i=new e.Vector2(o.width,o.height);return t.clone().sub(r).divide(i)}function f(t,n){return o=d(t,n),r=2*o.x-1,i=1-2*o.y,new e.Vector2(r,i);var o,r,i}var m={name:"VueThreeInteractions",props:{hover:Object,press:Object,drag:Object,select:Object},data:function(){return{currentStrategy:null,renderClock:null}},computed:{touchStartEventListener:function(){return this.onTouchStart.bind(this)},touchMoveEventListener:function(){return this.onTouchMove.bind(this)},touchEndEventListener:function(){return this.onTouchEnd.bind(this)},mouseMoveEventListener:function(){return this.onMouseMove.bind(this)},mouseDownEventListener:function(){return this.onMouseDown.bind(this)},mouseUpEventListener:function(){return this.onMouseUp.bind(this)},renderer:function(){return this.$parent.renderer},camera:function(){return this.$parent.camera},scene:function(){return this.$parent.scene},normalizedHover:function(){var e=this.hover;if(e)return Object.assign({distanceTolerance:2,delay:200,objectsFilter:c,interval:200,onHoverIn:a,onHoverOut:a},e)},normalizedPress:function(){var e=this.press;if(e)return Object.assign({distanceTolerance:2,delay:200,objectFilter:c,onPress:a},e)},normalizedDrag:function(){var e=this.drag;if(e)return Object.assign({distanceTolerance:2,delay:200,objectsFilter:c,onDragStart:a,onDrag:a,onDragEnd:a},e)},normalizedSelect:function(){var e=this.select;if(e)return Object.assign({shape:"rectangle",distanceTolerance:1,delay:200,objectsFilter:c,interval:200,borderWidth:1,borderColor:"rgba(0,0,0,0.5)",backgroundColor:"rgba(255,255,255,0.1)",onSelectStart:a,onSelect:a,onSelectEnd:a},e)},strategy:function(){return Object.assign({render:function(e){return e("div")},onTouchStart:a,onTouchMove:a,onTouchEnd:a,onMouseMove:a,onMouseDown:a,onMouseUp:a,onTick:a,onEnd:a},this.currentStrategy||this.initialStrategy)},initialStrategy:function(){var t,n,o,r,a,s,c,l,h,f,m,p,v,b,y=this.renderer.domElement,g=this.normalizedHover,w=this.normalizedPress,j=this.normalizedDrag,E=this.normalizedSelect;if(g||w||j||E)return{onMouseMove:function(t){if(g){var n,o=Date.now(),i=new e.Vector2(t.clientX,t.clientY);return{onMouseMove:function(t){if((n=new e.Vector2(t.clientX,t.clientY)).distanceTo(i)>g.distanceTolerance)return null},onMouseDown:u,onMouseUp:u,onTick:function(){if((r=Date.now())-o>g.delay){var t=0;return{onMouseMove:function(t){if((n=new e.Vector2(t.clientX,t.clientY)).distanceTo(i)>g.distanceTolerance)return null},onMouseDown:u,onMouseUp:u,onTick:function(){if((r=Date.now())-t>g.interval){t=r;var e=this.intersectPoint(n,g.objectFilter)[0];e!==a&&(a&&g.onHoverOut(a),e&&(a=e,g.onHoverIn(a,n.toArray())))}},onEnd:function(){a&&g.onHoverOut(a)}}}}}}},onMouseDown:function(a){var g=this;if(w||j||E)return function(w,j,E){var M,S;if(1===a.which&&a.target===y&&(t=new e.Vector2(a.clientX,a.clientY),w&&(M=g.intersectPoint(t,w.objectFilter),(s=M[0])||(w=!1)),j&&(S=g.intersectPoint(t,j.objectFilter),(c=S[0])?(l=c.position.clone(),E=!1):j=!1),w||j||E))return n=t,o=Date.now(),{onMouseMove:function(a){if(n=new e.Vector2(a.clientX,a.clientY),r=Date.now(),j&&r-o>j.delay)return n=new e.Vector2(a.clientX,a.clientY),j.onDragStart(c,n.toArray()),{onMouseMove:function(t){n=new e.Vector2(t.clientX,t.clientY),h=this.intersectPlane(l,n),j.onDrag(c,h.toArray(),n.toArray())},onMouseDown:u,onMouseUp:u,onEnd:function(){j.onDragEnd(c,h.toArray(),n.toArray())}};if(E&&r-o>E.delay){switch(n=new e.Vector2(a.clientX,a.clientY),b=r,E.shape){case"rectangle":f=this.intersectRectangle(t,n,E.objectFilter);break;case"ellipse":f=this.intersectEllipse(t,n,E.objectFilter)}return p=f,v=m=[],E.onSelectStart(t.toArray(),n.toArray()),E.onSelect(f.slice(),p.slice(),v.slice(),t.toArray(),n.toArray()),{render:function(e){var o=d(t,y),r=d(n,y),i=o.clone().min(r).clampScalar(0,1),a=o.clone().max(r).clampScalar(0,1).sub(i),s={backgroundColor:E.backgroundColor,border:E.borderWidth+"px solid "+E.borderColor,boxSizing:"border-box",height:100*a.y+"%",left:100*i.x+"%",position:"absolute",top:100*i.y+"%",width:100*a.x+"%"};return"ellipse"===E.shape&&(s.borderRadius="100%"),e("div",{style:{bottom:0,left:0,overflow:"hidden",position:"absolute",right:0,top:0}},[e("div",{style:s})])},onMouseMove:function(t){n=new e.Vector2(t.clientX,t.clientY),this.rerender()},onMouseDown:u,onMouseUp:u,onTick:function(){if((r=Date.now())-b>E.interval){switch(b=r,m=f,E.shape){case"rectangle":f=this.intersectRectangle(t,n,E.objectFilter);break;case"ellipse":f=this.intersectEllipse(t,n,E.objectFilter)}p=i(f,m),v=i(m,f),(p.length>0||v.length>0)&&E.onSelect(f.slice(),p.slice(),v.slice(),t.toArray(),n.toArray())}},onEnd:function(){E.onSelectEnd(f,t.toArray(),n.toArray())}}}return w&&n.distanceTo(t)>w.distanceTolerance&&(w=!1),j&&n.distanceTo(t)>j.distanceTolerance&&(j=!1),E&&n.distanceTo(t)>E.distanceTolerance&&(E=!1),w||j||E?void 0:null},onMouseUp:function(e){return w&&1===e.which&&this.intersectObject(n,s)&&w.onPress(s,n.toArray()),null}}}(w,j,E)}}}},mounted:function(){window.addEventListener("touchstart",this.touchStartEventListener),window.addEventListener("touchmove",this.touchMoveEventListener),window.addEventListener("touchend",this.touchEndEventListener),window.addEventListener("mousemove",this.mouseMoveEventListener),window.addEventListener("mousedown",this.mouseDownEventListener),window.addEventListener("mouseup",this.mouseUpEventListener),this.startTicking()},beforeDestroy:function(){window.removeEventListener("touchstart",this.touchStartEventListener),window.removeEventListener("touchmove",this.touchMoveEventListener),window.removeEventListener("touchend",this.touchEndEventListener),window.removeEventListener("mousemove",this.mouseMoveEventListener),window.removeEventListener("mousedown",this.mouseDownEventListener),window.removeEventListener("mouseup",this.mouseUpEventListener)},methods:{onTouchStart:function(e){var t=this.strategy,n=t.onTouchStart.call(this,e);void 0!==n&&(t.onEnd.call(this),this.currentStrategy=n,this.onTouchStart(e))},onTouchMove:function(e){var t=this.strategy,n=t.onTouchMove.call(this,e);void 0!==n&&(t.onEnd.call(this),this.currentStrategy=n,this.onTouchMove(e))},onTouchEnd:function(e){var t=this.strategy,n=t.onTouchEnd.call(this,e);void 0!==n&&(t.onEnd.call(this),this.currentStrategy=n,this.onTouchEnd(e))},onMouseMove:function(e){var t=this.strategy,n=t.onMouseMove.call(this,e);void 0!==n&&(t.onEnd.call(this),this.currentStrategy=n,this.onMouseMove(e))},onMouseDown:function(e){var t=this.strategy,n=t.onMouseDown.call(this,e);void 0!==n&&(t.onEnd.call(this),this.currentStrategy=n,this.onMouseDown(e))},onMouseUp:function(e){var t=this.strategy,n=t.onMouseUp.call(this,e);void 0!==n&&(t.onEnd.call(this),this.currentStrategy=n,this.onMouseUp(e))},onTick:function(){var e=this.strategy,t=e.onTick.call(this);void 0!==t&&(e.onEnd.call(this),this.currentStrategy=t,this.onTick())},startTicking:function(){var e=this;this._isDestroyed||(requestAnimationFrame(function(){e.startTicking()}),this.onTick())},rerender:function(){this.renderClock={}},createRaycaster:function(t){var n=f(t,this.renderer.domElement),o=new e.Raycaster;return o.setFromCamera(n,this.camera),o},intersectPoint:function(e,t){var n=this.scene.children.filter(t);return this.intersectObjects(e,n)},intersectObjects:function(e,t){return this.createRaycaster(e).intersectObjects(t).map(function(e){return e.object})},intersectObject:function(e,t){return!!this.createRaycaster(e).intersectObject(t).length},intersectPlane:function(t,n){var o=this.createRaycaster(n),r=new e.Plane;return r.setFromNormalAndCoplanarPoint(this.camera.getWorldDirection(r.normal),t),o.ray.intersectPlane(r)},intersectRectangle:function(t,n,o){var r=this,i=f(t,this.renderer.domElement),a=f(n,this.renderer.domElement),s=i.clone().min(a),c=i.clone().max(a),u=new e.Box2(s,c);return this.scene.children.filter(o).filter(function(t){var n=t.position.clone().project(r.camera);return n=new e.Vector2(n.x,n.y),u.containsPoint(n)})},intersectEllipse:function(t,n,o){var r=this,i=f(t,this.renderer.domElement),a=f(n,this.renderer.domElement),s=i.clone().min(a),c=i.clone().max(a),u=new e.Box2(s,c);return this.scene.children.filter(o).filter(function(t){var n=t.position.clone().project(r.camera);return n=new e.Vector2(n.x,n.y),function(e,t){return e.getCenter(l),function(e,t){e.getSize(t).divideScalar(2)}(e,h),Math.pow(t.x-l.x,2)/Math.pow(h.x,2)+Math.pow(t.y-l.y,2)/Math.pow(h.y,2)<=1}(u,n)})}},render:function(e){this.renderClock;return this.strategy.render(e)}},p={position:{type:Array,default:function(){return[0,0,0]}},quaternion:{type:Array,default:function(){return[0,0,0,1]}},scale:{type:Array,default:[1,1,1]},name:{type:String,default:""},userData:{default:function(){return{}}}};var v={object:function(){return new e.Object3D},renderer:function(){return this.$parent.renderer}},b={object:{handler:function(e,t){t&&(this.$parent.object.remove(t),this.dispose(t)),e&&this.$parent.object.add(e)},immediate:!0}};var y={dispose:a};var g={name:"VueThreeObject",mixins:[t([function(){this.object.position.fromArray(this.position)},function(){this.object.quaternion.fromArray(this.quaternion)},function(){this.object.scale.fromArray(this.scale)},function(){this.object.name=this.name},function(){this.object.userData=this.userData}])],props:p,computed:v,watch:b,beforeDestroy:function(){this.$parent.object.remove(this.object),this.dispose(this.object)},methods:y,render:function(e){return e("div",this.$slots.default)}};function w(e){return e&&"object"==typeof e}var j={name:"VueThreeOrbitControls",props:{cameraPosition:{type:[Object,Array],default:function(){return[0,0,0]}},cameraQuaternion:{type:[Object,Array],default:function(){return[0,0,0,1]}},enabled:{type:Boolean,default:!0},minDistance:{type:Number,default:0},maxDistance:{type:Number,default:1/0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:1/0},minPolarAngle:{type:Number,default:0},maxPolarAngle:{type:Number,default:Math.PI},minAzimuthAngle:{type:Number,default:-1/0},maxAzimuthAngle:{type:Number,default:1/0},enableDamping:{type:Boolean,default:!1},dampingFactor:{type:Number,default:.25},enableZoom:{type:Boolean,default:!0},zoomSpeed:{type:Number,default:1},enableRotate:{type:Boolean,default:!0},rotateSpeed:{type:Number,default:1},enablePan:{type:Boolean,default:!0},keyPanSpeed:{type:Number,default:7},autoRotate:{type:Boolean,default:!1},autoRotateSpeed:{type:Number,default:2},enableKeys:{type:Boolean,default:!0},intervalBetweenUpdateControls:{type:Number,default:1e3/60}},data:function(){return{frozen$object:Object.freeze({o:this.createObject()}),value:Object.freeze({cameraPosition:this.cameraPosition,cameraQuaternion:this.cameraQuaternion})}},computed:{object:function(){return this.frozen$object.o},renderer:function(){return this.$parent.renderer},controls:function(){return new THREE.OrbitControls(this.object,this.renderer.domElement)},startToUpdateControls:function(){return function(){var e=this;this._isDestroyed||(setTimeout(function(){requestAnimationFrame(function(){e.startToUpdateControls()})},this.intervalBetweenUpdateControls),this.updateControls())}}},watch:{cameraPosition:function(e){this.value.cameraPosition!==e&&this.setObject()},cameraQuaternion:function(e){this.value.cameraQuaternion!==e&&this.setObject()},controls:{handler:function(e,t){t&&this.dispose(t)},immediate:!0},value:function(e){var t=e.cameraPosition,n=e.cameraQuaternion;this.$emit("update:cameraPosition",t),this.$emit("update:cameraQuaternion",n)}},mounted:function(){this.startToUpdateControls()},beforeDestroy:function(){this.dispose(this.controls)},methods:{createObject:function(){var t=new e.PerspectiveCamera;return function(e,t){if(Array.isArray(t))e.fromArray(t);else if(w(t)){var n=t.x,o=t.y,r=t.z;Object.assign(e,{x:n,y:o,z:r})}else Number.isFinite(t)&&e.setScalar(t)}(t.position,this.cameraPosition),function(e,t){if(Array.isArray(t))e.fromArray(t);else if(w(t)){var n=t.x,o=t.y,r=t.z,i=t.w;Object.assign(e,{x:n,y:o,z:r,w:i})}}(t.quaternion,this.cameraQuaternion),t},setObject:function(){this.frozen$object=Object.freeze({o:this.createObject()})},dispose:function(e){e.dispose()},updateControls:function(){this.controls.update(),this.value=Object.freeze({cameraPosition:this.object.position.toArray(),cameraQuaternion:this.object.quaternion.toArray()})}},render:function(e){return e("div")}};Object.entries({setEnabled:function(){this.controls.enabled=this.enabled},setMinDistance:function(){this.controls.minDistance=this.minDistance},setMaxDistance:function(){this.controls.maxDistance=this.maxDistance},setMinZoom:function(){this.controls.minZoom=this.minZoom},setMaxZoom:function(){this.controls.maxZoom=this.maxZoom},setMinPolarAngle:function(){this.controls.minPolarAngle=this.minPolarAngle},setMaxPolarAngle:function(){this.controls.maxPolarAngle=this.maxPolarAngle},setMinAzimuthAngle:function(){this.controls.minAzimuthAngle=this.minAzimuthAngle},setMaxAzimuthAngle:function(){this.controls.maxAzimuthAngle=this.maxAzimuthAngle},setEnableDamping:function(){this.controls.enableDamping=this.enableDamping},setDampingFactor:function(){this.controls.dampingFactor=this.dampingFactor},setEnableZoom:function(){this.controls.enableZoom=this.enableZoom},setZoomSpeed:function(){this.controls.zoomSpeed=this.zoomSpeed},setEnableRotate:function(){this.controls.enableRotate=this.enableRotate},setRotateSpeed:function(){this.controls.rotateSpeed=this.rotateSpeed},setEnablePan:function(){this.controls.enablePan=this.enablePan},setKeyPanSpeed:function(){this.controls.keyPanSpeed=this.keyPanSpeed},setAutoRotate:function(){this.controls.autoRotate=this.autoRotate},setAutoRotateSpeed:function(){this.controls.autoRotateSpeed=this.autoRotateSpeed},setEnableKeys:function(){this.controls.enableKeys=this.enableKeys}}).forEach(function(e){var t=e[0],n=e[1];j.computed[t]=n,j.watch[t]=a});var E={fov:{type:Number,default:50},near:{type:Number,default:.1},far:{type:Number,default:2e3}};var M={object:function(){return new e.PerspectiveCamera}};var S={name:"VueThreePerspectiveCamera",mixins:[g,t([function(){this.object.fov=this.fov},function(){this.object.near=this.near},function(){this.object.far=this.far}])],props:E,computed:M,created:function(){this.$parent.$parent.camera=this.object},beforeDestroy:function(){this.$parent.$parent.camera=null}},A={color:{type:[Number,String],default:16777215},intensity:{type:Number,default:1},distance:{type:Number,default:0},decay:{type:Number,default:1}};var D={object:function(){return new e.PointLight}},T={name:"VueThreePointLight",mixins:[g,t([function(){this.object.color.set(this.color)},function(){this.object.intensity=this.intensity},function(){this.object.distance=this.distance},function(){this.object.decay=this.decay}])],props:A,computed:D};function P(e){return function(e){return"function"==typeof e}(e)?e:s(e)}var O="frozenData_";var x={antialias:{type:Boolean,default:!0},alpha:{type:Boolean,default:!1},clearColor:{type:[String,Number],default:0},clearAlpha:{type:Number,default:1},preserveDrawingBuffer:{type:Boolean,default:!1}};var z={renderer:function(){var t=this.alpha,n=this.antialias,o=this.preserveDrawingBuffer;return new e.WebGLRenderer({alpha:t,antialias:n,preserveDrawingBuffer:o})}};var C={name:"VueThreeRenderer",mixins:[function(e){var t={data:function(){var t={};return Object.entries(e).forEach(function(e){var n=e[0],o=e[1];t[O+n]=Object.freeze([o])}),t},computed:{}};return Object.keys(e).forEach(function(e){t.computed[e]={get:function(){return this[O+e][0]},set:function(t){return this[O+e]=Object.freeze([t])}}}),t}(function(){return{scene:null,camera:null}}),t([function(){var e=this.renderer,t=this.camera,n=this.elWidth,o=this.elHeight;e.setSize(n,o),n>0&&o>0&&t&&(t.aspect=n/o,t.updateProjectionMatrix())},function(){this.renderer.setClearColor(this.clearColor,this.clearAlpha)}]),function(e){var t=[],n=[],o=[],r=[];e.forEach(function(e){var i=e.method,a=e.delay,s=e.initialDelay;void 0===s&&(s=0);var c=e.requestAnimationFrame;void 0===c&&(c=!0);var u=e.start;void 0===u&&(u="mounted"),a=P(a),s=P(s),c=P(c);var l=function(){var e=this;requestAnimationFrame(function(){e._isDestroyed||(setTimeout(l.bind(e),a.call(e)),i.call(e))})};switch(u){case"beforeCreate":t.push(l);break;case"created":n.push(l);break;case"beforeMount":o.push(l);break;case"mounted":r.push(l)}});var i={};return t.length>0&&(i.beforeCreate=function(){var e=this;t.forEach(function(t){t.call(e)})}),n.length>0&&(i.created=function(){var e=this;n.forEach(function(t){t.call(e)})}),o.length>0&&(i.beforeMount=function(){var e=this;o.forEach(function(t){t.call(e)})}),r.length>0&&(i.mounted=function(){var e=this;r.forEach(function(t){t.call(e)})}),i}([{method:function(){this.elWidth=this.$el.offsetWidth,this.elHeight=this.$el.offsetHeight},delay:1e3},{method:function(){var e=this.renderer,t=this.scene,n=this.camera;e&&t&&n&&e.render(t,n)},delay:1e3/60}])],props:x,data:function(){return{elWidth:0,elHeight:0}},computed:z,mounted:function(){this.$refs.canvasContainer.appendChild(this.renderer.domElement)},render:function(e){return e("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},[e("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0},ref:"canvasContainer"},this.$slots.default)])}};var L={name:"VueThreeScene",computed:{object:function(){return new e.Scene},renderer:function(){return this.$parent.renderer}},created:function(){this.$parent.scene=this.object},beforeDestroy:function(){this.$parent.scene=null},render:function(e){return e("div",this.$slots.default)}},$=Object.freeze({Fog:r,Interactions:m,Object:g,OrbitControls:j,PerspectiveCamera:S,PointLight:T,Renderer:C,Scene:L}),N={install:function(e){Object.values(this.components).forEach(function(t){e.component(t.name,t)})},components:$};return Object.assign(N,$),"undefined"!=typeof window&&window.Vue&&window.Vue.use(N),N});
